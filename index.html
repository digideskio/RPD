<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
    <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>RPD by lynnard</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/lynnard/RPD">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>RPD</h1>
            <h2>Stream radio to command line with ease and comfort</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/lynnard/RPD/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/lynnard/RPD/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1>
<a name="rpd-radio-player-daemon" class="anchor" href="#rpd-radio-player-daemon"><span class="octicon octicon-link"></span></a>RPD (Radio Player Daemon)</h1>

<p><a href="http://rpd.lynnard.tk">RPD</a> is a fork from <a href="https://github.com/hzqtc/fmd">FMD</a> that aims to provide more advanced features</p>

<ul>
<li>Support for a wide variety of audio formats</li>
<li>Multi-threaded music streaming</li>
<li>Support for natural language music search engine <a href="http://jing.fm">Jing.fm</a> in addition to the popular <a href="http://douban.fm">Douban.fm</a>
</li>
<li>
<a href="#automatic-music-download">Automatic music download/tagging</a> for liked songs</li>
<li>More <a href="#commands">commands</a>, including changing bitrates on the fly</li>
<li>Playing local songs via <a href="#local%20channel">local channel</a>
</li>
</ul><p>RPD uses a TCP server-client model similar to that in FMD and MPD:</p>

<ul>
<li>you run <code>rpd</code> to launch the radio daemon that listens on a specific port</li>
<li>then in any terminal you can use <code>rpc</code> to access and control the daemon you just now launched</li>
</ul><h2>
<a name="install" class="anchor" href="#install"><span class="octicon octicon-link"></span></a>Install</h2>

<h3>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h3>

<ul>
<li>
<code>ffmpeg</code> for music decoding</li>
<li>
<code>libao</code> for music playing</li>
<li>
<code>libcurl</code> for api calls and music downloading</li>
<li>
<code>json-c</code> for json parsing</li>
<li>
<code>openssl</code> for validating downloaded songs using sha256</li>
<li>
<a href="https://github.com/lynnard/mutagen-CLI">mutagen-CLI</a> for manipulating music ID3 tags</li>
</ul><h3>
<a name="steps" class="anchor" href="#steps"><span class="octicon octicon-link"></span></a>Steps</h3>

<ol>
<li>clone the repo somewhere</li>
<li>
<code>cd</code> into the directory</li>
<li><code>make</code></li>
</ol><p>Note: you would almost certainly want to also install <a href="https://github.com/lynnard/RPC" title="RPC">RPC</a> to access and control the daemon. Follow the instruction there to finish installing <code>rpc</code>.</p>

<h3>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>By default, the configuration file resides in <code>~/.rpd/rpd.conf</code>.</p>

<p>A template config file looks like this</p>

<pre><code>[Radio]
channel = 999

[DoubanFM]
uid = &lt;uid&gt;
uname = &lt;username&gt;
token = &lt;token&gt;
expire = &lt;expire&gt;
kbps = 

[JingFM]
uid = &lt;uid&gt;
atoken = &lt;atoken&gt;
rtoken = &lt;rtoken&gt;

[Output]
driver = alsa
device = default

[Server]
address = 0.0.0.0
port = 10098

[Local]
music_dir = ~/Music
download_lyrics = 0
</code></pre>

<ul>
<li>
<code>channel</code> under <code>[Radio]</code>: determines the default channel on startup; <code>999</code> is the <a href="#local_channel">local music channel</a>
</li>
<li>
<code>kbps</code> under <code>[DoubanFM]</code> is only applicable for paid users (who have access to <code>128</code> and <code>192</code> bitrates); leave it blank if you are using the free service</li>
<li>
<code>[Local]</code>

<ul>
<li>
<code>music_dir</code>: where to store the downloaded songs</li>
<li>
<code>download_lyrics</code>: change it to 1 if you wish to download lyrics automatically using <a href="https://github.com/lynnard/rpdlrc">lrcdown</a> </li>
</ul>
</li>
</ul><p>To simplify the process of obtaining the user ids and tokens for the two services, you should use the <code>rpc-update-conf.sh</code> included in the repository. </p>

<p>Make sure you set the usernames and passwords in the file, and then you can put something like this in your crontab to periodically update the configuration (since the tokens change from time to time)</p>

<pre><code>0 0 */3 * * rpd-update-conf.sh &gt; ~/.rpd/rpd.conf
</code></pre>

<h2>
<a name="commands" class="anchor" href="#commands"><span class="octicon octicon-link"></span></a>Commands</h2>

<p>To communicate with RPD, the client should make a TCP connection to the designated port in the configuration.</p>

<p>A client can make the following requests:</p>

<ul>
<li>
<code>play</code>: start playing</li>
<li>
<code>stop</code>: stop playing</li>
<li>
<code>pause</code>: pause playing</li>
<li>
<code>toggle</code>: toggle between play and pause</li>
<li>
<code>skip</code>: skip to the next song</li>
<li>
<code>rate</code>: like the song</li>
<li>
<code>unrate</code>: unlike the song</li>
<li>
<code>ban</code>: dislike the song</li>
<li>
<code>info</code>: get song information</li>
<li>
<code>setch &lt;channel&gt;</code>: switch to the given radio channel

<ul>
<li>if <code>&lt;channel</code> is <code>999</code>, use the <a href="#local-channel">local music channel</a>
</li>
<li>if <code>&lt;channel&gt;</code> is an integer, than use the corresponding channel from Douban.fm</li>
<li>otherwise search for <code>&lt;channel&gt;</code> on Jing.fm

<ul>
<li>e.g., <code>setch Adele</code> starts playing music from Adele</li>
<li>there are also some special channels for Jing.fm

<ul>
<li>
<code>#top</code>: the hottest music right now</li>
<li>
<code>#rand</code>: this will start a random channel using a trending search term</li>
<li>
<code>#psn</code>: this starts Jing's personal recommendation channel (making use of your like and dislike data)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<code>kbps &lt;bitrate&gt;</code>: on-the-fly switching of music quality</li>
<li>
<code>webpage</code>: opens the douban music page for the current song using the browser specified in the shell variable <code>$BROWSER</code>; if the page url is not available e.g. for Jing.fm channels, it will open the search page on douban music</li>
<li>
<code>end</code>: tell RPD to exit</li>
</ul><p>The response is in JSON format and normally contains all the information about the currently playing song.</p>

<p>Note: if you installed <code>rpc</code> as I recommended before, you can easily use these commands as <code>rpc &lt;command&gt;</code>.</p>

<h2>
<a name="automatic-music-download" class="anchor" href="#automatic-music-download"><span class="octicon octicon-link"></span></a>Automatic music download</h2>

<p>All played and liked songs will be saved to <code>music_dir</code> in <code>artist/title.&lt;ext&gt;</code> format. </p>

<p>The ID3 tags (for <code>m4a</code>, iTunes-style tags) will be saved along as well. </p>

<p>The cover image, when downloadable, will be downloaded and embedded into the song.</p>

<p>If you've turned on <code>download_lyrics</code>, and have installed <a href="https://github.com/lynnard/rpdlrc">lrcdown</a>, then the lyrics will be downloaded as <code>artist/title.lrc</code> in the same directory.</p>

<h2>
<a name="local-channel" class="anchor" href="#local-channel"><span class="octicon octicon-link"></span></a>Local channel</h2>

<p>The local channel has the id <code>999</code>. When switching to this channel, RPD retrieves all files of mimetype <code>audio/*</code> within the <code>music_dir</code> and shuffles them to make up its playlist.</p>

<h3>
<a name="like" class="anchor" href="#like"><span class="octicon octicon-link"></span></a>Like</h3>

<p>By default all music is <code>liked</code>. If you unrate a song, the action would be the same as <code>ban</code>.</p>

<h3>
<a name="ban" class="anchor" href="#ban"><span class="octicon octicon-link"></span></a>Ban</h3>

<p>The song will be removed from your disk. In addition, if it's enclosed in some directory that becomes empty, that directory is removed as well.</p>

<h2>
<a name="related-work" class="anchor" href="#related-work"><span class="octicon octicon-link"></span></a>Related work</h2>

<ul>
<li>
<a href="https://github.com/lynnard/RPC" title="RPC">RPC</a>: RPD client</li>
<li>
<a href="https://github.com/lynnard/rpclrc">rpclrc</a>: lyrics display</li>
<li>
<a href="https://github.com/lynnard/RPD-Alfred">RPD-Alfred</a>: Alfred extension interfacing <a href="https://github.com/lynnard/RPC" title="RPC">RPC</a>
</li>
</ul>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/lynnard">lynnard</a> can be found on <a href="https://github.com/lynnard/RPD">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
