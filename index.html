<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640" />

    <link rel="stylesheet" href="stylesheets/core.css" media="screen"/>
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)"/>
    <link rel="stylesheet" href="stylesheets/pygment_trac.css"/>

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Fmd by lynnard</title>
  </head>

  <body>
    <a id="forkme_banner" href="https://github.com/lynnard/fmd">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Fmd</h1>
            <h2>Stream radio to command line with ease and comfort</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/lynnard/fmd/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/lynnard/fmd/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">
        <h1>
<a name="fmd-internet-radio-service-daemon" class="anchor" href="#fmd-internet-radio-service-daemon"><span class="octicon octicon-link"></span></a>FMD (Internet Radio Service Daemon)</h1>

<p>This is a fork from the original <a href="https://github.com/hzqtc/fmd">FMD</a>. The aim of this fork is to provide more advanced features.</p>

<h2>
<a name="architectural-differences" class="anchor" href="#architectural-differences"><span class="octicon octicon-link"></span></a>Architectural differences</h2>

<h3>
<a name="decoder" class="anchor" href="#decoder"><span class="octicon octicon-link"></span></a>Decoder</h3>

<p>This version of <code>fmd</code> uses <code>ffmpeg</code> instead of <code>mpg123</code> to decode music. The rational is to support more audio formats e.g. <code>m4a</code>.</p>

<h3>
<a name="network-transfer" class="anchor" href="#network-transfer"><span class="octicon octicon-link"></span></a>Network transfer</h3>

<p>Improving on the original model, this version uses a multi-threaded downloading framework to pull content from network. At any time when streaming music from an online service, multiple instances of <code>curl</code> keep running and caching songs until the queue becomes empty (the default number of song downloaders is 2 but you can change that number in the source file).</p>

<p>A negativity here is that when the program first starts pulling songs it's relatively slow, since the additional downloaders will take away bandwidth for the first song. However, this will be subsequently complemented by smoother music playing in all following songs. (Or you can simply change the number of assigned song downloaders to 1 to avoid this problem)</p>

<h2>
<a name="configuration-changes" class="anchor" href="#configuration-changes"><span class="octicon octicon-link"></span></a>Configuration changes</h2>

<p>If you have <code>channel</code> setting in <code>fmd.conf</code>, remember to move it outside <code>[DoubanFM]</code> and put it under <code>[Radio]</code> instead like this</p>

<pre><code>[Radio]
channel = 0
</code></pre>

<p>The reason for this is that there are more channels now in addition to those from Douban.</p>

<p>In addition, the sampling rate setting <code>rate = &lt;rate&gt;</code> is omitted from <code>[Output]</code> section because <code>ffmpeg</code> can automatically detect the sampling rate of the source audio and <code>libao</code> can then use that during playback.</p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<p>This version of <code>fmd</code> has the following dependencies:</p>

<ul>
<li>
<code>ffmpeg</code> for music decoding</li>
<li>
<code>libao</code> for music playing</li>
<li>
<code>libcurl</code> for api calls and music downloading</li>
<li>
<code>json-c</code> for json parsing</li>
<li>
<code>openssl</code> for validating cached songs using sha256</li>
<li>
<code>mutagen</code> for local music tagging</li>
<li>my mutagen <a href="mutagen">frontend</a> for accessing the useful functions from <code>mutagen</code>
</li>
</ul><h2>
<a name="local-music-channel--red-heart-channel" class="anchor" href="#local-music-channel--red-heart-channel"><span class="octicon octicon-link"></span></a>Local music channel / Red-Heart channel</h2>

<h3>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>To configure the local music channel simply put this in your <code>fmd.conf</code></p>

<pre><code>[Local]
music_dir = {default value: ~/Music}
</code></pre>

<p>The local channel comes with id <code>999</code> and if you also use my fork of <a href="https://github.com/lynnard/fmc">FMC</a>, it will display the channel name as the name of the current login user. All files of mimetype <code>audio/*</code> within the <code>music_dir</code> are added randomly to the playlist.</p>

<h3>
<a name="like" class="anchor" href="#like"><span class="octicon octicon-link"></span></a>Like</h3>

<p>By default all music is <code>liked</code>. If you unrate a song, the action would be the same as <code>ban</code>.</p>

<h3>
<a name="ban" class="anchor" href="#ban"><span class="octicon octicon-link"></span></a>Ban</h3>

<p>The song will be removed from your disk. In addition, if it's enclosed in some directory that becomes empty, that directory is removed as well.</p>

<p>The local music channel is also the fall-back channel if network becomes unavailable i.e. when <code>fmd</code> is unable to retrieve any playlists from online channels.</p>

<p>Aside from these things the local channel is almost identical to any online channel.</p>

<h2>
<a name="jingfm" class="anchor" href="#jingfm"><span class="octicon octicon-link"></span></a>Jing.fm</h2>

<h3>
<a name="configuration-1" class="anchor" href="#configuration-1"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>You need to first have a <a href="http://jing.fm">Jing.fm</a> account. Then run this line at the command line, replacing <code>&lt;email&gt;</code> and <code>&lt;password&gt;</code> accordingly.</p>

<pre><code>$ curl -i -d'email=&lt;email&gt;' -d'pwd=&lt;password&gt;' 'http://jing.fm/api/v1/sessions/create'
</code></pre>

<p>Copy down your userid (buried inside the JSON response <code>result.usr.id</code>), Jing-A-Token-Header and Jing-R-Token-Header and put them into your <code>fmd.conf</code></p>

<pre><code>[JingFM]
atoken = &lt;Jing-A-Token-Header&gt;
rtoken = &lt;Jing-R-Token-Header&gt;
uid = &lt;uid&gt;
</code></pre>

<h3>
<a name="channels" class="anchor" href="#channels"><span class="octicon octicon-link"></span></a>Channels</h3>

<p>To start a Jing.fm channel, simply use the old command <code>setch &lt;string&gt;</code>. While any integer value will be interpreted as a Douban channel, all other strings will be seen as queries into Jing.fm. For example:</p>

<pre><code>fmc setch '周杰伦'
</code></pre>

<p>will start a new Jing.fm channel on 周杰伦.</p>

<p>In addition, some channels are <em>special</em> </p>

<ul>
<li>
<code>#top</code>: this is identical to listening to music from the 音乐瀑布 on the official webpage</li>
<li>
<code>#rand</code>: this will start a random channel using a trending search term (which is the same as the 'suggestion' function on the official webpage)</li>
<li>
<code>#psn</code>: this starts Jing's personal recommendation channel</li>
</ul><h3>
<a name="like--ban" class="anchor" href="#like--ban"><span class="octicon octicon-link"></span></a>Like &amp; Ban</h3>

<p>These actions are identical to those used with Douban channels from the user point of view. But of course now the data is sent to jing.fm instead.</p>

<h2>
<a name="music-caching" class="anchor" href="#music-caching"><span class="octicon octicon-link"></span></a>Music Caching</h2>

<p>All played and liked songs will be saved to <code>music_dir</code> (as specified in the <a href="#local">Local</a> section) in <code>artist/title.&lt;ext&gt;</code> format. The ID3 tags (for <code>m4a</code>, iTunes-style tags) will be saved along as well. The cover image, when downloadable, will be downloaded and embedded into the song.</p>

<h2>
<a name="more-fine-grained-infomation" class="anchor" href="#more-fine-grained-infomation"><span class="octicon octicon-link"></span></a>More fine-grained infomation</h2>

<p>The <code>info</code> command will now also give back the <code>kbps</code> rate of the current song. This can be different depending on each song.</p>

<h2>
<a name="more-commands" class="anchor" href="#more-commands"><span class="octicon octicon-link"></span></a>More commands</h2>

<p>A few more commands are added in this fork. They include</p>

<ul>
<li>
<code>kbps &lt;bitrate&gt;</code>: on-the-fly switching of music quality</li>
<li>
<code>webpage</code>: opens the douban music page for the current song using the browser specified in the shell variable <code>$BROWSER</code>; if the page url is not available e.g. for Jing.fm channels, it will open the search page on douban music</li>
</ul>
      </section>

      <footer>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <p>this project by <a href="https://github.com/lynnard">lynnard</a> can be found on <a href="https://github.com/lynnard/fmd">GitHub</a></p>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
        <p>Generated with <a href="http://pages.github.com">GitHub Pages</a> using Merlot</p>
        <span class="octocat"></span>
      </footer>

    </div>

    
  </body>
</html>
